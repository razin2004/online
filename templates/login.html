<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Online Voting System â€” Secure Access Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI, Arial;}

body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#0b1220;
  color:#fff;
}

/* ---------- MAIN WRAPPER ---------- */

.wrapper{
  width:960px;
  height:600px;
  border-radius:18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 30px 60px rgba(0,0,0,.45);
  backdrop-filter:blur(10px);
  position:relative;
}

.panel{
  position:absolute;
  width:50%;
  height:100%;
  padding:34px;
  transition:.6s;
  background:rgba(15,23,42,.88);
  overflow-y:auto;
}

.panel::-webkit-scrollbar{width:6px;}
.panel::-webkit-scrollbar-thumb{background:#334155;border-radius:8px;}

.welcome{
  position:absolute;
  width:50%;
  height:100%;
  right:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
}

h1{font-size:24px;margin-bottom:6px;}
.sub{font-size:13px;color:#9ca3af;margin-bottom:10px;}

/* ---------- FIELDS ---------- */

.field{margin-top:10px;}
.field label{font-size:12px;color:#cbd5e1;}
.field input{
  width:100%;
  padding:10px;
  margin-top:4px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.08);
  color:#fff;
}

/* ---------- BUTTONS ---------- */

.btn{
  width:100%;
  padding:11px;
  border-radius:9px;
  border:none;
  font-weight:600;
  cursor:pointer;
  margin-top:12px;
}

.primary{background:#22c55e;}
.primary:hover{background:#16a34a;}

.blue{background:#2563eb;}
.blue:hover{background:#1d4ed8;}

.neutral{background:rgba(255,255,255,.1);}
.neutral:hover{background:rgba(255,255,255,.18);}

/* ---------- PANEL STATES ---------- */

.login-panel{left:0;}
.register-panel{left:-100%;}
.voter-panel{left:-200%;}

.wrapper.register .login-panel{left:100%;}
.wrapper.register .register-panel{left:0;}

.wrapper.voter .login-panel{left:200%;}
.wrapper.voter .voter-panel{left:0;}

/* ---------- VOTER OPTION CARDS ---------- */

.option-box{
  margin-top:10px;
  border:1px solid rgba(255,255,255,.25);
  border-radius:10px;
  padding:12px;
  cursor:pointer;
  background:rgba(255,255,255,.06);
}

.option-box:hover{background:rgba(255,255,255,.12);}
.option-form{display:none;margin-top:8px;}

/* ---------- FORGOT PASSWORD MODAL ---------- */

.reset-overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(6px);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999; /* ensures overlay is above welcome panel */
}


.reset-box{
  width:420px;
  background:linear-gradient(180deg,#0f172a,#020617);
  border-radius:16px;
  border:1px solid rgba(255,255,255,.15);
  padding:18px;
  box-shadow:0 35px 80px rgba(0,0,0,.6);
}

.reset-title{
  font-size:18px;
  font-weight:700;
  margin-bottom:4px;
}

.reset-sub{
  font-size:12px;
  color:#9ca3af;
  margin-bottom:10px;
}

.reset-btn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  margin-top:10px;
  font-weight:600;
  cursor:pointer;
}

.green{background:#22c55e;}
.green:hover{background:#16a34a;}

.gray{background:#4b5563;}
.gray:hover{background:#6b7280;}

</style>
</head>

<body>

{% set messages = get_flashed_messages(with_categories=True) %}
{% set open_panel = request.args.get('panel', 'login') %}

{% if messages %}
  {% for cat,msg in messages %}

    {# --- force open REGISTER panel on any admin register alert --- #}
    {% if "register" in cat or "admin_register" in cat %}
      {% set open_panel = "register" %}
    {% endif %}

    {# --- force open VOTER panel on any voter alert --- #}
    {% if "voter" in cat %}
      {% set open_panel = "voter" %}
    {% endif %}

  {% endfor %}
{% endif %}


{# ensure open_panel can be passed from render_template() #}
{% if open_panel is not defined %}
  {% set open_panel = request.args.get('panel', 'login') %}
{% endif %}


<div id="wrap"
     class="wrapper
     {% if open_panel == 'register' %} register
     {% elif open_panel == 'voter' %} voter
     {% endif %}">


  <!-- ========== ADMIN LOGIN PANEL ========== -->

  <div class="panel login-panel">

    <h1>Welcome to the Voting Portal</h1>
    <p class="sub">Please select your login mode to continue.</p>

    <h1>Admin Login</h1>
    <p class="sub">Sign in to manage elections, candidates and results.</p>

    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat == "admin_login_error" %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;
          padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <form method="POST" action="/admin/login">

      <div class="field">
        <label>Username</label>
        <input name="username" required>
      </div>

      <div class="field">
        <label>Password</label>
        <input type="password" name="password" required>
      </div>

      <button class="btn blue">Login as Admin</button>
      <p style="margin-top:6px;font-size:12px;color:#9ca3af;">
        Forgot your password?
        <a href="javascript:void(0)" id="openReset" style="color:#ecd072;">
          Reset password
        </a>
      </p>

      <p style="margin-top:10px;font-size:12px;color:#9ca3af;">
        Donâ€™t have an admin account?
        <a href="javascript:void(0)" id="openRegister" style="color:#7dd3fc;">
          Create account
        </a>
      </p>

    </form>

    <hr style="margin:16px 0;opacity:.25;">

    <h1>Voter Access</h1>
    <p class="sub">Continue here if you are participating in an election.</p>

    <button class="btn primary" id="openVoter">
      Continue as Voter
    </button>

    <div style="margin-top:6px;font-size:12px;color:#9ca3af;">
      You will receive an OTP to verify your identity before voting.
    </div>

  </div>



  <!-- ========== ADMIN REGISTER PANEL ========== -->

  <div class="panel register-panel">

    <h1>Create Admin Account</h1>
    <p class="sub">
      An OTP will be sent to your registered email for verification.
    </p>

    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat in ["admin_register_error","admin_register_success"] %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;
          padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <form method="POST" action="/admin/register">

      <div class="field"><label>Full Name</label>
        <input name="name" 
       value="{{ form.name if form else '' }}" required></div>

      <div class="field"><label>Username</label>
        <input name="username" 
       value="{{ form.username if form else '' }}" required></div>

      <div class="field"><label>Mobile Number</label>
        <input name="mobile" 
       value="{{ form.mobile if form else '' }}" required></div>

      <div class="field"><label>Email Address</label>
        <input type="email" name="email"
       value="{{ form.email if form else '' }}" required></div>

      <div class="field"><label>Password</label>
        <input type="password" name="password" required></div>

      <div class="field"><label>Confirm Password</label>
        <input type="password" name="confirm" required></div>

      <button class="btn blue">Send OTP & Complete Registration</button>

      <p style="margin-top:10px;font-size:12px;color:#9ca3af;">
        Already have an admin account?
        <a href="javascript:void(0)" id="backLogin1" style="color:#7dd3fc;">
          Go back to login
        </a>
      </p>

    </form>
  </div>



  <!-- ========== VOTER LOGIN PANEL ========== -->

  <div class="panel voter-panel">

    <h1>Voter Login</h1>
    <p class="sub">Choose your election type and continue with OTP verification.</p>

    <!-- PUBLIC ELECTION -->
    <div class="option-box" id="optPublic">
      ðŸŸ¢ Public Election â€” Open Participation
    </div>

    <!-- PRIVATE ELECTION -->
    <div class="option-box" id="optPrivate">
      ðŸ”µ Private Election â€” Admin Approved Access
    </div>

    <p style="margin-top:10px;font-size:12px;color:#9ca3af;">
      Want to switch back?
      <a href="javascript:void(0)" id="backLogin2" style="color:#7dd3fc;">
        Return to main login
      </a>
    </p>

  </div>

  <!-- RIGHT STATIC PANEL -->
  <div class="welcome">
    <h2>Online Voting System</h2>
    <p style="color:#cbd5e1;font-size:13px;">
      Secure â€¢ Verified â€¢ One Vote Per User
    </p>
  </div>

<!-- ========== FORGOT PASSWORD RESET PANEL ========== -->

<div id="resetOverlay" class="reset-overlay">

  <div class="reset-box">

    <div class="reset-title">Reset Admin Password</div>
    <div class="reset-sub">
      Enter your registered admin email â€” an OTP will be sent to verify identity.
    </div>

    <form method="POST" action="/admin/forgot-password">

      <div class="field">
        <label>Email Address</label>
        <input type="email" name="email" required>
      </div>

      <button class="reset-btn green">Send Reset OTP</button>
    </form>
<button id="closeReset"
        style="
          background:none;
          border:none;
          color:#809dd1;
          font-size:12px;
          margin-top:6px;
          cursor:pointer;
          text-decoration:underline;
        ">
  Back to Login
</button>


    <p style="margin-top:6px;font-size:11px;color:#9ca3af;">
      For security reasons, the system will not confirm whether an email exists.
    </p>
  </div>

</div>

</div>

<!-- ================= PUBLIC VOTER OTP POPUP ================= -->

<div id="publicOtpOverlay" class="reset-overlay">

  <div class="reset-box">

    <div class="reset-title">Public Voting â€” OTP Verification</div>

    <div class="reset-sub">
      Enter your email address to receive a secure OTP before voting.
    </div>
    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat == "voter_public_error" %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;
          padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <form method="POST" action="/voter/login/public" novalidate>

      <div class="field">
        <label>Email Address</label>
        <input type="email" name="email" required>
      </div>

      <button class="reset-btn green">
        Send OTP & Continue
      </button>
    </form>

    <button onclick="closePublicOtp()"
            style="background:none;border:none;color:#9fb6ff;
            font-size:12px;margin-top:6px;cursor:pointer;text-decoration:underline;">
      Cancel & Return
    </button>

  </div>
</div>



<!-- ================= PRIVATE VOTER OTP POPUP ================= -->

<div id="privateOtpOverlay" class="reset-overlay">

  <div class="reset-box">

    <div class="reset-title">Private Voting â€” Secure Access</div>

    <div class="reset-sub">
      Enter Admin Code and your Email â€” OTP verification required.
    </div>
    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat == "voter_private_error" %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;
          padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <form method="POST" action="/voter/login/private" novalidate>

      <div class="field">
        <label>Admin Code</label>
        <input name="admin_code" required>
      </div>

      <div class="field">
        <label>Email Address</label>
        <input type="email" name="email" required>
      </div>

      <button class="reset-btn blue">
        Send OTP & Continue
      </button>
    </form>

    <button onclick="closePrivateOtp()"
            style="background:none;border:none;color:#9fb6ff;
            font-size:12px;margin-top:6px;cursor:pointer;text-decoration:underline;">
      Cancel & Return
    </button>

  </div>
</div>


<script>

// ---------- Forgot Password Panel ----------

const resetOverlay = document.getElementById("resetOverlay");

document.getElementById("openReset").onclick = ()=>{
  resetOverlay.style.display="flex";
};

document.getElementById("closeReset").onclick = ()=>{
  resetOverlay.style.display="none";
};

const wrap = document.getElementById("wrap");

// panel switching
document.getElementById("openVoter").onclick   = ()=> wrap.className="wrapper voter";
document.getElementById("openRegister").onclick= ()=> wrap.className="wrapper register";

document.getElementById("backLogin1").onclick  =
document.getElementById("backLogin2").onclick  =
()=> wrap.className="wrapper";

// voter panel toggles
// ==== VOTER OTP MODALS ====

const publicOtpOverlay  = document.getElementById("publicOtpOverlay");
const privateOtpOverlay = document.getElementById("privateOtpOverlay");

document.getElementById("optPublic").onclick = ()=>{
  publicOtpOverlay.style.display = "flex";
};

document.getElementById("optPrivate").onclick = ()=>{
  privateOtpOverlay.style.display = "flex";
};

function closePublicOtp(){
  publicOtpOverlay.style.display = "none";
}

function closePrivateOtp(){
  privateOtpOverlay.style.display = "none";
}

// ===== AUTO-HIDE SYSTEM MESSAGES (3.5 seconds) =====
setTimeout(() => {

  document.querySelectorAll(
    "div[style*='background:#7f1d1d'], \
     div[style*='background:#334155'], \
     div[style*='background:#2c0a0a'], \
     div[style*='background:#022c22']"
  ).forEach(el => el.remove());

}, 3500);

/* ===== PANEL MEMORY SYSTEM ===== */

// apply stored panel on load
const savedPanel = sessionStorage.getItem("active_panel");
if(savedPanel){
  wrap.className = "wrapper " + savedPanel;
}

// store panel whenever user switches
document.getElementById("openVoter").onclick = ()=>{
  wrap.className="wrapper voter";
  sessionStorage.setItem("active_panel","voter");
};

document.getElementById("openRegister").onclick = ()=>{
  wrap.className="wrapper register";
  sessionStorage.setItem("active_panel","register");
};

document.getElementById("backLogin1").onclick =
document.getElementById("backLogin2").onclick = ()=>{
  wrap.className="wrapper";
  sessionStorage.setItem("active_panel","");
};

// when OTP / redirects bring custom panel â€” keep it
if("{{ open_panel }}" === "voter"){
  sessionStorage.setItem("active_panel","voter");
}
if("{{ open_panel }}" === "register"){
  sessionStorage.setItem("active_panel","register");
}
// reopen popup when validation error occurs
const last_error = "{{ messages[-1][0] if messages else '' }}";

if(last_error === "voter_public_error"){
  publicOtpOverlay.style.display = "flex";
}

if(last_error === "voter_private_error"){
  privateOtpOverlay.style.display = "flex";
}

</script>

</body>
</html>

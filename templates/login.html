<!DOCTYPE html>
<html lang="en">
<head>
<link rel="icon" type="image/svg+xml" href="/static/uploads/votecentral-icon.svg">
<meta charset="UTF-8" />
<title>VoteCentral ‚Äî Secure Online Voting</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI, Arial;}
html, body{
  height:100%;
  overflow:hidden;   /* üîí page never scrolls */
}

body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#0b1220;
  color:#fff;
}

/* ---------- MAIN WRAPPER ---------- */

.wrapper{
  width:960px;
  height:600px;
  border-radius:18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.1);
  box-shadow:0 30px 60px rgba(0,0,0,.45);
  backdrop-filter:blur(10px);
  position:relative;
}

.panel{
  position:absolute;
  width:50%;
  height:100%;
  padding:34px;
  transition:.6s;
  background:rgba(15,23,42,.88);
  overflow-y:auto;
}

.panel::-webkit-scrollbar{width:6px;}
.panel::-webkit-scrollbar-thumb{background:#334155;border-radius:8px;}

.welcome{
  position:absolute;
  width:50%;
  height:100%;
  right:0;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
}

h1{font-size:24px;margin-bottom:6px;}
.sub{font-size:13px;color:#9ca3af;margin-bottom:10px;}

/* ---------- FIELDS ---------- */

.field{margin-top:10px;}
.field label{font-size:12px;color:#cbd5e1;}
.field input{
  width:100%;
  padding:10px;
  margin-top:4px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.08);
  color:#fff;
}
.mobile-header{
  display:none;
}
/* ---------- BUTTONS ---------- */

.btn{
  width:100%;
  padding:11px;
  border-radius:9px;
  border:none;
  font-weight:600;
  cursor:pointer;
  margin-top:12px;
}

.primary { background:#2563eb; }
.primary:hover { background:#1d4ed8; }


.blue{background:#2563eb;}
.blue:hover{background:#1d4ed8;}

.neutral{background:rgba(255,255,255,.1);}
.neutral:hover{background:rgba(255,255,255,.18);}

/* ---------- PANEL STATES ---------- */

.login-panel{left:0;}
.register-panel{left:-100%;}
.voter-panel{left:-200%;}

.wrapper.register .login-panel{left:100%;}
.wrapper.register .register-panel{left:0;}

.wrapper.voter .login-panel{left:200%;}
.wrapper.voter .voter-panel{left:0;}

/* ---------- VOTER OPTION CARDS ---------- */

.option-box{
  margin-top:10px;
  border:1px solid rgba(255,255,255,.25);
  border-radius:10px;
  padding:12px;
  cursor:pointer;
  background:rgba(255,255,255,.06);
}

.option-box:hover{background:rgba(255,255,255,.12);}
.option-form{display:none;margin-top:8px;}

/* ---------- FORGOT PASSWORD MODAL ---------- */

.reset-overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(6px);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999; /* ensures overlay is above welcome panel */
}


.reset-box{
  width:420px;
  background:linear-gradient(180deg,#0f172a,#020617);
  border-radius:16px;
  border:1px solid rgba(255,255,255,.15);
  padding:18px;
  box-shadow:0 35px 80px rgba(0,0,0,.6);
}

.reset-title{
  font-size:18px;
  font-weight:700;
  margin-bottom:4px;
}

.reset-sub{
  font-size:12px;
  color:#9ca3af;
  margin-bottom:10px;
}

.reset-btn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  margin-top:10px;
  font-weight:600;
  cursor:pointer;
}

.gray{background:#4b5563;}
.gray:hover{background:#6b7280;}
.green{background:#22c55e;}
.green:hover{background:#16a34a;}

.reset-panel{left:-300%;}
.wrapper.reset .login-panel{left:300%;}
.wrapper.reset .reset-panel{left:0;}
/* =====================================================
   MOBILE & TABLET OVERRIDES (NON-DESTRUCTIVE)
   ===================================================== */

@media (max-width: 900px) {

  body{
    align-items:flex-start;
    padding:12px;
  }

  .wrapper{
    width:100%;
    height:auto;
    min-height:100vh;
    border-radius:14px;
  }

  /* STACK PANELS INSTEAD OF SIDE-BY-SIDE */
  .panel{
    position:relative;
    width:100%;
    height:auto;
    padding:22px 18px;
    left:0 !important;
    transition:none;
  }

  /* DISABLE SLIDING MECHANISM SAFELY */
  .wrapper.register .login-panel,
  .wrapper.voter .login-panel,
  .wrapper.reset .login-panel{
    display:none;
  }

  .register-panel,
  .voter-panel,
  .reset-panel{
    display:none;
  }

  .wrapper.register .register-panel,
  .wrapper.voter .voter-panel,
  .wrapper.reset .reset-panel{
    display:block;
  }

  /* HIDE RIGHT STATIC WELCOME PANEL */
  .welcome{
    display:none;
  }

  /* BUTTONS ‚Äî BETTER TOUCH TARGETS */
  .btn,
  .reset-btn{
    padding:14px;
    font-size:15px;
    border-radius:12px;
  }

  /* INPUTS */
  .field input{
    padding:13px;
    font-size:15px;
  }

  /* OPTION BOXES */
  .option-box{
    padding:16px;
    font-size:15px;
  }

}
@media (max-width: 600px){
  .reset-overlay{
    align-items:flex-start;
    padding-top:30px;
  }

  .reset-box{
    width:92%;
    max-width:420px;
  }
}
/* =====================================================
   PREMIUM MOBILE VISUAL LAYER
   ===================================================== */
@media (max-width: 900px){
  .panel{
    max-height: calc(100vh - 120px); /* header-safe */
  }
}
@media (max-width: 900px){

  body{
    background:linear-gradient(180deg,#020617,#0b1220);
  }

  .wrapper{
    background:transparent;
    border:none;
    box-shadow:none;
  }

  .panel{
    background:linear-gradient(
      180deg,
      rgba(15,23,42,.95),
      rgba(2,6,23,.95)
    );
    border-radius:18px;
    margin-bottom:16px;
    box-shadow:0 25px 60px rgba(0,0,0,.55);
  }

.panel{
  overflow-y:auto;
  overscroll-behavior:contain; /* prevents scroll chaining */
  -webkit-overflow-scrolling:touch;
}

  h1{
    font-size:20px;
    line-height:1.2;
  }

  .sub{
    font-size:13px;
    line-height:1.4;
  }

}
/* =====================================================
   MOBILE BOTTOM-SHEET OTP STYLE
   ===================================================== */

@media (max-width: 600px){

  .reset-overlay{
    align-items:flex-end;
    padding:0;
  }

  .reset-box{
    width:100%;
    max-width:none;
    border-radius:18px 18px 0 0;
    animation:slideUp .35s ease;
  }

  @keyframes slideUp{
    from{transform:translateY(100%);}
    to{transform:translateY(0);}
  }

}
/* =====================================================
   MICRO INTERACTIONS (MOBILE ONLY)
   ===================================================== */

@media (max-width: 900px){

  .btn,
  .option-box,
  .reset-btn{
    transition:transform .15s ease, box-shadow .15s ease;
  }

  .btn:active,
  .reset-btn:active,
  .option-box:active{
    transform:scale(.97);
    box-shadow:0 12px 30px rgba(0,0,0,.4);
  }

}
@media (max-width: 900px){

  hr{
    margin:22px 0;
    border:0;
    height:1px;
    background:linear-gradient(
      to right,
      transparent,
      rgba(255,255,255,.15),
      transparent
    );
  }

}
@media (max-width: 900px){

  .field label{
    font-size:12px;
    letter-spacing:.3px;
  }

  .field input{
    margin-top:6px;
  }

}
/* =====================================================
   PREMIUM MOBILE HEADER (REPLACES DESKTOP WELCOME)
   ===================================================== */

@media (max-width: 900px){

  .mobile-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:10px 14px;
    margin-bottom:14px;

    background:linear-gradient(
      180deg,
      rgba(15,23,42,.95),
      rgba(2,6,23,.95)
    );

    border-radius:0px;
    box-shadow:0 18px 45px rgba(0,0,0,.55);
  }

  .mh-left,
  .mh-right{
    width:48px;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .mh-center{
    text-align:center;
    flex:1;
    
  }

  .mh-title{
    font-size:15px;
    font-weight:700;
    letter-spacing:.4px;
  }

  .mh-sub{
    font-size:11px;
    color:#9ca3af;
    margin-top:2px;
  }

 

  .mh-dot{
    width:10px;
    height:10px;
    border-radius:50%;
    background:#22c55e;
    box-shadow:0 0 0 4px rgba(34,197,94,.15);
  }

}
/* =====================================================
   FIX MOBILE HEADER ALIGNMENT (TOP-ANCHORED)
   ===================================================== */

@media (max-width: 900px){

  body{
    display:block;            /* stop centering layout */
    padding:12px;
    padding-top:84px;         /* space for fixed header */
  }

  .wrapper{
    margin-top:0;             /* ensure clean flow */
  }

}
/* =====================================================
   KEEP MOBILE HEADER FIXED & ALWAYS VISIBLE
   ===================================================== */

@media (max-width: 900px){

  body{
    overflow-y:hidden;
  }

  .mobile-header{
    position:fixed;
    top:0px;
    left:0px;
    right:0px;
    z-index:20000;
  }

  /* content scrolls UNDER header */
  #wrap{
    margin-top:0;
  }

}
/* =====================================================
   CENTER VOTER OTP POPUPS (MOBILE & DESKTOP)
   ===================================================== */

#publicOtpOverlay,
#privateOtpOverlay{
  align-items:center !important;
}

@media (max-width: 600px){

  #publicOtpOverlay .reset-box,
  #privateOtpOverlay .reset-box{
    width:92%;
    max-width:420px;
    border-radius:16px;
    animation:fadeScale .25s ease;
  }

  @keyframes fadeScale{
    from{
      opacity:0;
      transform:scale(.95);
    }
    to{
      opacity:1;
      transform:scale(1);
    }
  }

}
/* =====================================================
   MOBILE HEADER TITLE ANIMATION
   ===================================================== */

.mh-title{
  position: relative;
  display: inline-block;
  transition: opacity .25s ease, transform .25s ease;
}

.mh-title.fade-out{
  opacity: 0;
  transform: translateY(-6px);
}

.mh-title.fade-in{
  opacity: 1;
  transform: translateY(0);
}
/* =====================================================
   MOBILE HEADER TITLE ‚Äî DIRECTION AWARE
   ===================================================== */

.mh-title{
  position: relative;
  display: inline-block;
  transition: opacity .28s ease, transform .28s ease;
  will-change: transform, opacity;
}

.mh-title.exit-left{
  opacity: 0;
  transform: translateX(-12px);
}

.mh-title.exit-right{
  opacity: 0;
  transform: translateX(12px);
}

.mh-title.enter{
  opacity: 1;
  transform: translateX(0);
}
/* =====================================================
   MOBILE HEADER ‚Äî BREADCRUMB DOTS
   ===================================================== */

.mh-dots{
  display:flex;
  justify-content:center;
  gap:6px;
  margin-top:6px;
}

.mh-dots span{
  width:6px;
  height:6px;
  border-radius:50%;
  background:rgba(255,255,255,.25);
  transition:
    transform .25s ease,
    background .25s ease,
    box-shadow .25s ease;
}

.mh-dots span.active{
  background:#22c55e;
  transform:scale(1.25);
  box-shadow:0 0 0 4px rgba(34,197,94,.18);
}
/* =====================================================
   MOBILE PANEL SAFE BOTTOM SPACE
===================================================== */
@media (max-width: 900px){
  .panel::after{
    content:"";
    display:block;
    height:48px;
  }
}
@media (max-width: 900px){
  .panel{
    padding-bottom: calc(72px + env(safe-area-inset-bottom));
  }
}

@media (max-width: 900px){
  .panel{
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
}
.icon{
  width:18px;
  height:18px;
  fill:currentColor;
  vertical-align:middle;
  margin-right:8px;
}
/* ================= BRAND LOGO ================= */

.brand-logo{
  display:block;
  width:auto;
}

/* big logo for login / welcome panel */
.brand-logo--hero{
  height:48px;        /* ‚¨Ö increase this value */
  margin-bottom:-10px;
  margin-left: 100px;
}

/* ================= MOBILE HEADER LOGO CENTERING ================= */

.mobile-header{
  position:fixed;
  top:0;
  left:0;
  right:0;
  height:64px;
  align-items:center;
  justify-content:center;   /* logical center */
  z-index:20000;
}

/* force true visual center */
.mobile-header .mh-center{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
}

/* logo size */
.brand-logo--mobile{
height: 35px;
margin-bottom: -8px;
margin-left: 75px;
margin-top: 2px;
}




</style>
</head>

<body>
<!-- ========== MOBILE HEADER (MEDIA VIEW ONLY) ========== -->
<div class="mobile-header">
 
  <div class="mh-center">
<img src="/static/uploads/votecentral-logo.svg"
     class="brand-logo brand-logo--mobile"
     alt="VoteCentral">

    <div class="mh-sub">Secure ‚Ä¢ Verified ‚Ä¢ One Vote Per Voter
</div>
    <div class="mh-dots">
      <span data-panel="login"></span>
      <span data-panel="register"></span>
      <span data-panel="voter"></span>
      <span data-panel="reset"></span>
    </div>
  </div>


 
</div>

{% set messages = get_flashed_messages(with_categories=True) %}
{% set open_panel = request.args.get('panel', 'login') %}

{% if messages %}
  {% for cat,msg in messages %}

    {# --- force open REGISTER panel on any admin register alert --- #}
    {% if "register" in cat or "admin_register" in cat %}
      {% set open_panel = "register" %}
    {% endif %}

    {# --- force open VOTER panel on any voter alert --- #}
    {% if "voter" in cat %}
      {% set open_panel = "voter" %}
    {% endif %}

  {% endfor %}
{% endif %}


{# ensure open_panel can be passed from render_template() #}
{% if open_panel is not defined %}
  {% set open_panel = request.args.get('panel', 'login') %}
{% endif %}


<div id="wrap"
     class="wrapper
     {% if open_panel == 'register' %} register
     {% elif open_panel == 'voter' %} voter
     {% endif %}">


  <!-- ========== ADMIN LOGIN PANEL ========== -->

  <div class="panel login-panel">

    <h1>Welcome to the Voting Portal</h1>
    <p class="sub">Please select your login mode to continue.</p>

    <h1>Admin Login</h1>
    <p class="sub">Sign in to manage elections, candidates, and results securely.
</p>

    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat == "admin_login_error" %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;
          padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}

        {% if cat == "admin_login_success" %}
          <div id="loginSuccess"
              style="background:#022c22;border:1px solid #22c55e;
              padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}


    <form method="POST" action="/admin/login">

      <div class="field">
        <label>Username</label>
        <input name="username" required>
      </div>

      <div class="field">
        <label>Password</label>
        <input type="password" name="password" required>
      </div>

      <button class="btn blue">Login as Admin</button>
      <p style="margin-top:6px;font-size:12px;color:#9ca3af;">
        <a href="javascript:void(0)"
          id="openRecovery"
          style="color:#7dd3fc;">
          Forgot username or password?
        </a>
      </p>


      <p style="margin-top:10px;font-size:12px;color:#9ca3af;">
        Don‚Äôt have an admin account?
        <a href="javascript:void(0)" id="openRegister" style="color:#7dd3fc;">
          Create account
        </a>
      </p>

    </form>

    <hr style="margin:16px 0;opacity:.25;">

    <h1>Voter Access</h1>
    <p class="sub">Continue here if you are participating in an election.</p>

    <button class="btn primary" id="openVoter">
      Continue as Voter
    </button>

    <div style="margin-top:6px;font-size:12px;color:#9ca3af;">
      A one-time password (OTP) will be sent to verify your identity before voting.

    </div>

  </div>



  <!-- ========== ADMIN REGISTER PANEL ========== -->

  <div class="panel register-panel">

    <h1>Create Admin Account</h1>
    <p class="sub">
      An OTP will be sent to your registered email for verification.
    </p>

    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat == "admin_register_error" %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;">
            {{ msg }}
          </div>
        {% endif %}

        {% if cat == "admin_register_success" %}
          <div style="background:#022c22;border:1px solid #22c55e;">
            {{ msg }}
          </div>
        {% endif %}

      {% endfor %}
    {% endif %}

    <form method="POST" action="/admin/register">

      <div class="field"><label>Full Name</label>
        <input name="name" 
       value="{{ form.name if form else '' }}" required></div>

      <div class="field"><label>Username</label>
        <input name="username" 
       value="{{ form.username if form else '' }}" required></div>
      <div id="usernameStatus" style="font-size:12px;margin-top:4px;"></div>


      <div class="field"><label>Mobile Number</label>
        <input name="mobile" 
       value="{{ form.mobile if form else '' }}" required></div>

      <div class="field"><label>Email Address</label>
        <input type="email" name="email"
       value="{{ form.email if form else '' }}" required></div>
       <div id="emailStatus" style="font-size:12px;margin-top:4px;"></div>


      <div class="field"><label>Password</label>
        <input type="password" name="password" required></div>

      <div class="field"><label>Confirm Password</label>
        <input type="password" name="confirm" required></div>
        <div id="passwordStatus" style="font-size:12px;margin-top:4px;"></div>


      <button class="btn blue">Send OTP & Complete Registration</button>

      <p style="margin-top:10px;font-size:12px;color:#9ca3af;">
        Already have an admin account?
        <a href="javascript:void(0)" id="backLogin1" style="color:#7dd3fc;">
          Go back to login
        </a>
      </p>

    </form>
  </div>

  <!-- ========== VOTER LOGIN PANEL ========== -->

  <div class="panel voter-panel">

    <h1>Voter Login</h1>
    <p class="sub">Choose your election type and continue with OTP verification.</p>

<div class="option-box" id="optPublic">
  <svg class="icon" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10"/>
    <path d="M8 12l3 3 5-6"/>
  </svg>
  Public Election ‚Äî Open Participation
</div>


<div class="option-box" id="optPrivate">
  <svg class="icon" viewBox="0 0 24 24">
    <rect x="5" y="11" width="14" height="10" rx="2"/>
    <path d="M8 11V7a4 4 0 0 1 8 0v4"/>
  </svg>
  Private Election ‚Äî Admin Approved Access
</div>


    <p style="margin-top:10px;font-size:12px;color:#9ca3af;">
      Want to switch back?
      <a href="javascript:void(0)" id="backLogin2" style="color:#7dd3fc;">
        Return to main login
      </a>
    </p>

  </div>
  <div class="panel reset-panel">

  {# ================= FLASH MESSAGES ================= #}
  {% if messages %}
    {% for cat, msg in messages %}
      {% if cat in ["otp_error","otp_success","admin_login_success","admin_login_error"] %}
        <div
          style="
            margin-bottom:10px;
            padding:10px;
            border-radius:8px;
            font-size:12px;
            {% if cat == 'otp_error' %}
              background:#7f1d1d;border:1px solid #ef4444;
            {% else %}
              background:#022c22;border:1px solid #22c55e;
            {% endif %}
          ">
          {{ msg }}
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- =================================================
       STEP 1: RECOVERY CHOICE
  ================================================== -->
  <div id="recoveryChoice"
      {% if session.get("otp_reset_verified") %}style="display:none;"{% endif %}>

    <h1>Account Recovery</h1>
    <p class="sub">Choose how you want to recover your account.</p>

    <button class="btn blue" id="choosePassword">
      Reset Password
    </button>

    <button class="btn blue" id="chooseUsername">
      Recover Username
    </button>

    <p style="margin-top:10px;font-size:12px;">
      <a href="javascript:void(0)" id="resetBackLogin" style="color:#7dd3fc;">
        Back to Login
      </a>
    </p>

  </div>

  <!-- =================================================
       STEP 2A: PASSWORD RESET (EMAIL ‚Üí OTP)
  ================================================== -->
<div id="passwordRecovery"
     {% if session.get("otp_reset_verified") %}style="display:block;"{% else %}style="display:none;"{% endif %}>


    {% if not session.get("otp_reset_verified") %}

      <h1>Reset Password</h1>
      <p class="sub">Enter your registered admin email to receive OTP.</p>

      <form method="POST" action="/admin/forgot-password">
        <div class="field">
          <label>Email Address</label>
          <input type="email" name="email" required>
        </div>

        <button class="btn blue">Send OTP</button>
      </form>
<p style="margin-top:10px;font-size:12px;">
  <a href="javascript:void(0)"
     class="recoveryBack"
     style="color:#7dd3fc;">
    ‚Üê Back
  </a>
</p>

    {% else %}

      <h1>Create New Password</h1>
      <p class="sub">OTP verified. Create a new password.</p>

      <form method="POST" action="/admin/reset-password">
        <div class="field">
          <label>New Password</label>
          <input type="password" name="password" required>
        </div>

        <div class="field">
          <label>Confirm Password</label>
          <input type="password" name="confirm" required>
        </div>

        <div id="passwordStatus" style="font-size:12px;margin-top:4px;"></div>

        <button class="btn green">Save New Password</button>
      </form>
      <button class="btn neutral"
        onclick="confirmCancelReset()">
  Cancel Password Reset
</button>


    {% endif %}

  </div>

  <!-- =================================================
       STEP 2B: USERNAME RECOVERY (EMAIL ONLY)
  ================================================== -->
  <div id="usernameRecovery" style="display:none;">

    <h1>Recover Username</h1>
    <p class="sub">
      Enter your admin email. Your username will be sent to your email.
    </p>

    <form method="POST" action="/admin/forgot-username">
      <div class="field">
        <label>Email Address</label>
        <input type="email" name="email" required>
      </div>

      <button class="btn blue">Send Username</button>
    </form>
<p style="margin-top:10px;font-size:12px;">
  <a href="javascript:void(0)"
     class="recoveryBack"
     style="color:#7dd3fc;">
    ‚Üê Back
  </a>
</p>

  </div>

</div>


  <!-- RIGHT STATIC PANEL -->
  <div class="welcome">
   <img src="/static/uploads/votecentral-logo.svg"
     class="brand-logo brand-logo--hero"
     alt="VoteCentral">

    <p style="color:#cbd5e1;font-size:13px;">
      Secure ‚Ä¢ Verified ‚Ä¢ One Vote Per User
    </p>
  </div>



</div>

<!-- ================= PUBLIC VOTER OTP POPUP ================= -->

<div id="publicOtpOverlay" class="reset-overlay">

  <div class="reset-box">

    <div class="reset-title">Public Voting ‚Äî OTP Verification</div>

    <div class="reset-sub">
      Enter your email address to receive a secure OTP before voting.
    </div>
    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat == "voter_public_error" %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;
          padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <form method="POST" action="/voter/login/public" novalidate>

      <div class="field">
        <label>Email Address</label>
        <input type="email" name="email" required>
      </div>

      <button class="reset-btn blue">
        Send OTP & Continue
      </button>
    </form>

    <button onclick="closePublicOtp()"
            style="background:none;border:none;color:#9fb6ff;
            font-size:12px;margin-top:6px;cursor:pointer;text-decoration:underline;">
      Cancel & Return
    </button>

  </div>
</div>



<!-- ================= PRIVATE VOTER OTP POPUP ================= -->

<div id="privateOtpOverlay" class="reset-overlay">

  <div class="reset-box">

    <div class="reset-title">Private Voting ‚Äî Secure Access</div>

    <div class="reset-sub">
      Enter Admin Code and your Email ‚Äî OTP verification required.
    </div>
    {% if messages %}
      {% for cat,msg in messages %}
        {% if cat == "voter_private_error" %}
          <div style="background:#7f1d1d;border:1px solid #ef4444;
          padding:8px;border-radius:8px;font-size:12px;margin-bottom:8px;">
            {{ msg }}
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}

    <form method="POST" action="/voter/login/private" novalidate>

      <div class="field">
        <label>Admin Code</label>
        <input name="admin_code" required>
      </div>

      <div class="field">
        <label>Email Address</label>
        <input type="email" name="email" required>
      </div>

      <button class="reset-btn blue">
        Send OTP & Continue
      </button>
    </form>

    <button onclick="closePrivateOtp()"
            style="background:none;border:none;color:#9fb6ff;
            font-size:12px;margin-top:6px;cursor:pointer;text-decoration:underline;">
      Cancel & Return
    </button>

  </div>
</div>

<script>
function confirmCancelReset(){
  if(confirm("Are you sure? You will need OTP again to reset password.")){
    window.location.href = "/admin/reset-cancel";
  }
}
document.querySelectorAll(".recoveryBack").forEach(btn => {
  btn.addEventListener("click", () => {
    document.getElementById("recoveryChoice").style.display = "block";
    document.getElementById("passwordRecovery").style.display = "none";
    document.getElementById("usernameRecovery").style.display = "none";
  });
});

</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const recoveryChoice   = document.getElementById("recoveryChoice");
  const passwordRecovery = document.getElementById("passwordRecovery");
  const usernameRecovery = document.getElementById("usernameRecovery");

  document.getElementById("choosePassword")?.addEventListener("click", () => {
    recoveryChoice.style.display = "none";
    passwordRecovery.style.display = "block";
    usernameRecovery.style.display = "none";
  });

  document.getElementById("chooseUsername")?.addEventListener("click", () => {
    recoveryChoice.style.display = "none";
    passwordRecovery.style.display = "none";
    usernameRecovery.style.display = "block";
  });

});
</script>

<script>
let wrap;
let publicOtpOverlay;
let privateOtpOverlay;

document.addEventListener("DOMContentLoaded", () => {

  wrap = document.getElementById("wrap");
  publicOtpOverlay  = document.getElementById("publicOtpOverlay");
  privateOtpOverlay = document.getElementById("privateOtpOverlay");

  // rest of your code unchanged


  /* =====================================================
     ADMIN / MAIN PANEL CONTROLS
  ===================================================== */

  document.getElementById("openRecovery")?.addEventListener("click", () => {
    wrap.className = "wrapper reset";
    sessionStorage.setItem("active_panel", "reset");
  });


  document.getElementById("resetBackLogin")?.addEventListener("click", () => {
    wrap.className = "wrapper";
    sessionStorage.removeItem("active_panel");
  });

  document.getElementById("openRegister")?.addEventListener("click", () => {
    wrap.className = "wrapper register";
    sessionStorage.setItem("active_panel", "register");
  });

  document.getElementById("openVoter")?.addEventListener("click", () => {
    wrap.className = "wrapper voter";
    sessionStorage.setItem("active_panel", "voter");
  });

  document.getElementById("backLogin1")?.addEventListener("click", () => {
    wrap.className = "wrapper";
    sessionStorage.removeItem("active_panel");
  });

  document.getElementById("backLogin2")?.addEventListener("click", () => {
    wrap.className = "wrapper";
    sessionStorage.removeItem("active_panel");
  });

  /* =====================================================
     VOTER OTP POPUPS
  ===================================================== */

  document.getElementById("optPublic")?.addEventListener("click", () => {
    publicOtpOverlay.style.display = "flex";
  });

  document.getElementById("optPrivate")?.addEventListener("click", () => {
    privateOtpOverlay.style.display = "flex";
  });

  window.closePublicOtp = () => {
    publicOtpOverlay.style.display = "none";
  };

  window.closePrivateOtp = () => {
    privateOtpOverlay.style.display = "none";
  };

  /* =====================================================
     PANEL MEMORY (SESSION STORAGE)
  ===================================================== */

  const savedPanel = sessionStorage.getItem("active_panel");
  if (savedPanel) {
    wrap.className = "wrapper " + savedPanel;
  }

  // server-forced panel (after redirects)
  const serverPanel = "{{ open_panel }}";
  if (serverPanel === "reset") {
  wrap.className = "wrapper reset";
  sessionStorage.setItem("active_panel", "reset");
}

  if (serverPanel === "voter") {
    wrap.className = "wrapper voter";
    sessionStorage.setItem("active_panel", "voter");
  }
  if (serverPanel === "register") {
    wrap.className = "wrapper register";
    sessionStorage.setItem("active_panel", "register");
  }
  

  /* =====================================================
     AUTO-OPEN OTP POPUP ON ERROR
  ===================================================== */

  const last_error = "{{ messages[-1][0] if messages else '' }}";

  // ‚úÖ Password reset success ‚Üí force admin login panel
if (document.getElementById("loginSuccess")) {
  sessionStorage.removeItem("active_panel");
  wrap.className = "wrapper";
}

  if (last_error === "voter_public_error") {
    publicOtpOverlay.style.display = "flex";
  }

  if (last_error === "voter_private_error") {
    privateOtpOverlay.style.display = "flex";
  }

  /* =====================================================
     AUTO-HIDE FLASH MESSAGES
  ===================================================== */

  setTimeout(() => {
    document.querySelectorAll(
      "div[style*='background:#7f1d1d'], \
       div[style*='background:#334155'], \
       div[style*='background:#2c0a0a'], \
       div[style*='background:#022c22']"
    ).forEach(el => el.remove());
  }, 3000);
/* =====================================================
   RESET SCROLL WHEN SWITCHING PANELS (MOBILE FIX)
   ===================================================== */

/* =====================================================
   HARD RESET SCROLL WHEN SWITCHING PANELS (MOBILE SAFE)
   ===================================================== */

const resetAllScroll = () => {
  // reset panel-level scroll (desktop & fallback)
  document.querySelectorAll(".panel").forEach(p => {
    p.scrollTop = 0;
  });

  // reset page-level scroll (mobile)
  window.scrollTo({
    top: 0,
    left: 0,
    behavior: "instant" in window ? "instant" : "auto"
  });

  // iOS Safari fallback
  document.documentElement.scrollTop = 0;
  document.body.scrollTop = 0;
};

// reset scroll on all panel switch actions
[
  "openRegister",
  "openVoter",
  "openReset",
  "backLogin1",
  "backLogin2",
  "resetBackLogin"
].forEach(id => {
  document.getElementById(id)?.addEventListener("click", () => {
    setTimeout(resetAllScroll, 0);
  });
});

// reset scroll on initial / server-forced panel
setTimeout(resetAllScroll, 0);

/* =====================================================
   MOBILE HEADER TITLE ‚Äî DIRECTION AWARE ANIMATION
   ===================================================== */

if (window.innerWidth < 900) {

  const header = document.querySelector(".mobile-header");
  const title  = header?.querySelector(".mh-title");

  if (header && title) {

    const panelOrder = {
      login: 0,
      register: 1,
      voter: 2,
      reset: 3
    };

    let currentIndex = panelOrder[
      wrap.classList.contains("register") ? "register" :
      wrap.classList.contains("voter")    ? "voter" :
      wrap.classList.contains("reset")    ? "reset" :
      "login"
    ];

    const getPanelName = () => {
      if (wrap.classList.contains("register")) return "register";
      if (wrap.classList.contains("voter"))    return "voter";
      if (wrap.classList.contains("reset"))    return "reset";
      return "login";
    };

    const panelTitles = {
      login:    "VoteCentral",
      register: "Admin Registration",
      voter:    "Voter Access",
      reset:    "Password Reset"
    };

    const updateHeader = () => {
      const panel = getPanelName();
      const nextIndex = panelOrder[panel];
      const newTitle  = panelTitles[panel];

      if (title.textContent === newTitle) return;

      const direction =
        nextIndex > currentIndex ? "exit-left" : "exit-right";

      // animate out
      title.classList.remove("enter");
      title.classList.add(direction);

      setTimeout(() => {
        title.textContent = newTitle;

        title.classList.remove("exit-left", "exit-right");
        title.classList.add("enter");

        currentIndex = nextIndex;
      }, 180);
    };

    // initial sync
    title.classList.add("enter");
    updateHeader();

    // observe panel class changes
    const observer = new MutationObserver(updateHeader);
    observer.observe(wrap, {
      attributes: true,
      attributeFilter: ["class"]
    });

  }
  /* =====================================================
   MOBILE HEADER ‚Äî BREADCRUMB DOTS SYNC
   ===================================================== */

const dots = header.querySelectorAll(".mh-dots span");

const updateDots = () => {
  const panel =
    wrap.classList.contains("register") ? "register" :
    wrap.classList.contains("voter")    ? "voter" :
    wrap.classList.contains("reset")    ? "reset" :
    "login";

  dots.forEach(dot => {
    dot.classList.toggle(
      "active",
      dot.dataset.panel === panel
    );
  });
};

// initial
updateDots();

// sync with panel changes
const dotsObserver = new MutationObserver(updateDots);
dotsObserver.observe(wrap, {
  attributes:true,
  attributeFilter:["class"]
});

}

});

/* =====================================================
   PREMIUM MOBILE FEEL (SAFE POLISH)
   ===================================================== */

if (window.innerWidth < 900) {

  // subtle vibration on important taps (supported devices only)
  document.querySelectorAll(".btn, .option-box").forEach(el=>{
    el.addEventListener("click",()=>{
      navigator.vibrate?.(8);
    });
  });

}

</script>
<script>
/* =====================================================
   LIVE VALIDATION ‚Äî USERNAME / PASSWORD / NAME
===================================================== */

document.addEventListener("DOMContentLoaded", () => {

  /* ---------- REGEX (same as backend) ---------- */
  const USERNAME_REGEX = /^(?!_)[a-z0-9_]{1,15}(?<!_)$/;
  const PASSWORD_REGEX = /^(?=.*[A-Z])(?=.*[^A-Za-z0-9]).{8,}$/;

  /* ---------- ELEMENTS ---------- */
  const usernameInput = document.querySelector(
    ".register-panel input[name='username']"
  );
  const usernameStatus = document.getElementById("usernameStatus");

  const nameInput = document.querySelector(
    ".register-panel input[name='name']"
  );

  const passwordInput = document.querySelector(
    ".register-panel input[name='password'], .reset-panel input[name='password']"
  );
  const confirmInput = document.querySelector(
    ".register-panel input[name='confirm'], .reset-panel input[name='confirm']"
  );
  const passwordStatus = document.getElementById("passwordStatus");

  /* ---------- NAME AUTO CAPITALIZE ---------- */
  if (nameInput) {
    nameInput.addEventListener("blur", () => {
      nameInput.value = nameInput.value
        .toLowerCase()
        .replace(/\b\w/g, c => c.toUpperCase());
    });
  }

  /* ---------- USERNAME NORMALIZE + CHECK ---------- */
  if (usernameInput && usernameStatus) {
    let debounce;

    usernameInput.addEventListener("input", () => {

      // normalize
      let v = usernameInput.value
        .toLowerCase()
        .replace(/[^a-z0-9_]/g, "")
        .slice(0, 15);

      usernameInput.value = v;

      clearTimeout(debounce);

      // invalid format
      // empty ‚Üí show nothing
if (!v) {
  usernameStatus.textContent = "";
  return;
}

// invalid format
if (!USERNAME_REGEX.test(v)) {
  usernameStatus.textContent =
    "Invalid username. Please choose another.";
  usernameStatus.style.color = "#facc15";
  return;
}


      // debounce backend call
      debounce = setTimeout(() => {
        fetch(`/admin/check-username?username=${encodeURIComponent(v)}`)
          .then(r => r.json())
          .then(data => {
            if (!data.valid) {
              usernameStatus.textContent = "Invalid email address. Please enter a valid email.";
              usernameStatus.style.color = "#facc15";
            } else if (!data.available) {
              usernameStatus.textContent = "Username already exists";
              usernameStatus.style.color = "#ef4444";
            } else {
              usernameStatus.textContent = "Username available";
              usernameStatus.style.color = "#22c55e";
            }
          })
          .catch(() => {
            usernameStatus.textContent = "Unable to check username";
            usernameStatus.style.color = "#f97316";
          });
      }, 350);
    });
  }

  /* ---------- PASSWORD STRENGTH + MATCH ---------- */
  const checkPasswords = () => {
  if (!passwordInput || !confirmInput || !passwordStatus) return;

  const p = passwordInput.value;
  const c = confirmInput.value;

  // nothing typed
  if (!p && !c) {
    passwordStatus.textContent = "";
    return;
  }

  // weak password
  if (p && !PASSWORD_REGEX.test(p)) {
    passwordStatus.textContent =
      "Weak password. Please enter a strong password.";
    passwordStatus.style.color = "#ef4444";
    return;
  }

  // strong password but confirm empty
  if (PASSWORD_REGEX.test(p) && !c) {
    passwordStatus.textContent = "Strong password";
    passwordStatus.style.color = "#22c55e";
    return;
  }

  // mismatch
  if (p !== c) {
    passwordStatus.textContent = "Passwords do not match";
    passwordStatus.style.color = "#ef4444";
    return;
  }

  // match
  passwordStatus.textContent = "Passwords match";
  passwordStatus.style.color = "#22c55e";
};
  

  passwordInput?.addEventListener("input", checkPasswords);
  confirmInput?.addEventListener("input", checkPasswords);
/* ---------- EMAIL AVAILABILITY CHECK ---------- */

const emailInput = document.querySelector(
  ".register-panel input[name='email']"
);
const emailStatus = document.getElementById("emailStatus");

if (emailInput && emailStatus) {
  let emailDebounce;

  emailInput.addEventListener("input", () => {
    const email = emailInput.value.trim().toLowerCase();
    emailInput.value = email;

    clearTimeout(emailDebounce);

    if (!email || !email.includes("@") || !email.includes(".")) {
      emailStatus.textContent = "Invalid email format";
      emailStatus.style.color = "#facc15";
      return;
    }

    emailDebounce = setTimeout(() => {
      fetch(`/admin/check-email?email=${encodeURIComponent(email)}`)
        .then(r => r.json())
        .then(data => {
          if (!data.valid) {
            emailStatus.textContent = "Invalid email format";
            emailStatus.style.color = "#facc15";
          } else if (!data.available) {
            emailStatus.textContent = "Email already registered";
            emailStatus.style.color = "#ef4444";
          } else {
            emailStatus.textContent = "Email available";
            emailStatus.style.color = "#22c55e";
          }
        })
        .catch(() => {
          emailStatus.textContent = "Unable to check email";
          emailStatus.style.color = "#f97316";
        });
    }, 350);
  });
}

});
</script>


</body>
</html>

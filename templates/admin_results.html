<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Admin â€” Election Results</title>
    <style>
        :root {
            --bg: #020617;
            --card-bg: rgba(15, 23, 42, 0.8);
            --border: rgba(255, 255, 255, 0.1);
            --accent: #3b82f6;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --glass: blur(12px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
        body { background: var(--bg); color: var(--text-main); line-height: 1.5; padding-bottom: 40px; }

        /* NAVIGATION */
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(11, 18, 32, 0.5);
            backdrop-filter: var(--glass);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .btn-dash {
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            transition: 0.3s;
        }

        .container { width: 1000px; max-width: 95%; margin: 20px auto; }

        /* FILTER AREA */
        .filter-card {
            background: var(--card-bg);
            backdrop-filter: var(--glass);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }

        input, select {
            background: #0f172a;
            border: 1px solid #334155;
            color: white;
            padding: 12px;
            border-radius: 10px;
            outline: none;
        }

        /* PREMIUM TABLE (Desktop) */
        .results-container { overflow-x: auto; }
        .desktop-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }

        .desktop-table th { padding: 15px; text-align: left; color: var(--text-dim); font-size: 13px; text-transform: uppercase; }
        .desktop-table tr { background: var(--card-bg); transition: 0.2s; }
        .desktop-table td { padding: 16px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        .desktop-table td:first-child { border-left: 1px solid var(--border); border-radius: 12px 0 0 12px; }
        .desktop-table td:last-child { border-right: 1px solid var(--border); border-radius: 0 12px 12px 0; }

        /* MOBILE CARDS (Hidden on Desktop) */
        .mobile-card {
            display: none;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
        }

        /* STATUS COLORS */
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .badge-pub { background: #065f46; color: #34d399; }
        .badge-pri { background: #1e3a8a; color: #93c5fd; }
        
        .btn-open { background: var(--accent); border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; }
        .btn-locked { background: #334155; color: #94a3b8; border: none; padding: 8px 16px; border-radius: 8px; cursor: not-allowed; }

        /* MODAL POPUP */
        .modal-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(4px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background: #1e293b; border: 1px solid var(--accent);
            padding: 30px; border-radius: 20px; max-width: 400px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .modal-content h3 { color: #ef4444; margin-bottom: 10px; }
        .modal-content p { color: #cbd5e1; margin-bottom: 20px; }

        /* RESPONSIVE LOGIC */
        @media (max-width: 768px) {
            .filter-grid { grid-template-columns: 1fr; }
            .desktop-table { display: none; }
            .mobile-card { display: block; }
            .nav-header h2 { font-size: 18px; }
        }
    </style>
</head>
<body>

<nav class="nav-header">
    <h2>Election Central</h2>
    <a href="/admin/dashboard" class="btn-dash">Dashboard</a>
</nav>

<div class="container">
    <div class="filter-card">
        <div class="section-title">Results Overview</div>
        <div class="filter-grid">
            <input id="searchBox" placeholder="Search elections...">
            <select id="filterType">
                <option value="">All Types</option>
                <option value="public">Public</option>
                <option value="private">Private</option>
            </select>
            <select id="filterStatus">
                <option value="">All Status</option>
                <option value="available">Available</option>
                <option value="locked">Locked</option>
            </select>
        </div>
    </div>

    <div class="results-container">
        <table class="desktop-table">
            <thead>
                <tr>
                    <th>Election</th>
                    <th>Type</th>
                    <th>Votes</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for e in elections %}
                <tr class="result-row" data-name="{{ e.name|lower }}" data-type="{{ e.type }}" data-status="{{ 'available' if e.can_open else 'locked' }}">
                    <td><strong>{{ e.name }}</strong></td>
                    <td><span class="badge {{ 'badge-pub' if e.type == 'public' else 'badge-pri' }}">{{ e.type.upper() }}</span></td>
                    <td>{{ e.total_votes }}</td>
                    <td>
                        {% if e.can_open %}
                            <a href="/admin/results/{{ e.id }}"><button class="btn-open">Open</button></a>
                        {% else %}
                            <button class="btn-locked" onclick="showReason('{{ e.reason }}')">Locked</button>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% for e in elections %}
        <div class="mobile-card result-row" data-name="{{ e.name|lower }}" data-type="{{ e.type }}" data-status="{{ 'available' if e.can_open else 'locked' }}">
            <div style="display:flex; justify-content: space-between; margin-bottom: 10px;">
                <span class="badge {{ 'badge-pub' if e.type == 'public' else 'badge-pri' }}">{{ e.type.upper() }}</span>
                <span style="color: var(--text-dim)">{{ e.total_votes }} votes</span>
            </div>
            <h3 style="margin-bottom: 15px;">{{ e.name }}</h3>
            {% if e.can_open %}
                <a href="/admin/results/{{ e.id }}" style="text-decoration:none;"><button class="btn-open" style="width:100%">Open Result</button></a>
            {% else %}
                <button class="btn-locked" style="width:100%" onclick="showReason('{{ e.reason }}')">Result Locked</button>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h3>Access Restricted</h3>
        <p id="reasonText"></p>
        <button class="btn-open" onclick="closeModal()">Understood</button>
    </div>
</div>

<script>
    function showReason(msg) {
        document.getElementById('reasonText').innerText = msg;
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('modalOverlay').style.display = 'none';
    }

    // Filter Logic
    const searchBox = document.getElementById("searchBox");
    const filterType = document.getElementById("filterType");
    const filterStatus = document.getElementById("filterStatus");

    function applyFilters(){
        const q = searchBox.value.toLowerCase();
        const type = filterType.value;
        const status = filterStatus.value;

        document.querySelectorAll(".result-row").forEach(row => {
            const name = row.dataset.name;
            const t = row.dataset.type;
            const s = row.dataset.status;
            let show = true;
            if(q && !name.includes(q)) show = false;
            if(type && t !== type) show = false;
            if(status && s !== status) show = false;
            row.style.display = show ? "" : "none";
        });
    }

    searchBox.onkeyup = applyFilters;
    filterType.onchange = applyFilters;
    filterStatus.onchange = applyFilters;
</script>
</body>
</html>